name: Replace Old Code with New


on:
  pull_request:
    branches:
      - main
    types:
      - opened
      - synchronize

jobs:
  replace:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get Updated Code
        id: process-files
        uses: actions/github-script@v5
        with:
          script: |
            const { owner, repo, number } = context.issue;
            const { data: files } = await github.rest.pulls.listFiles({ owner, repo, pull_number: number });
            const updatedFiles = [];
            const fs = require('fs');
            for (const file of files) {
              const fileContent = fs.readFileSync(file.filename, 'utf8');
              console.log("file content");
              console.log(fileContent);
              console.log('----------');
              const response = await github.request({
                url: 'https://reqres.in/api/users',
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  "name": "morpheus",
                  "job": "leader"
                })
              });
              const newContent = response.data.id;
              console.log("server response:");
              console.log(newContent);
              console.log('---------------------');
              fs.writeFileSync(file.filename, newContent, 'utf8');
              updatedFiles.push({
                path: file.filename,
                explanation: newContent
              });
            }
            return {
              updatedFiles
            };
      - name: Set Git identity
        run: |
          git config --global user.email "dharanijasthi12@gmail.com"
          git config --global user.name "dharanijasthi"

      - name: Commit and Push
        run: |
          git checkout
          git add .
          git commit -m "Replace old code with new"
          git push

      - name: Create Branch
        run: git checkout -b new-branch
